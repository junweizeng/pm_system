(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b59517e2"],{"175c":function(t,e,a){},9202:function(t,e,a){"use strict";a("175c")},dbd9:function(t,e,a){"use strict";a.r(e);a("498a"),a("a4d3"),a("e01a");var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("el-card",{staticClass:"title-wrapper",attrs:{shadow:"never"}},[t._v(" 任务名称："),e("el-input",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.taskName,callback:function(e){t.taskName="string"===typeof e?e.trim():e},expression:"taskName"}})],1),e("el-card",{staticClass:"param-wrapper",attrs:{shadow:"never"}},[e("div",{staticClass:"panel"},[e("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t.userAvatar,fit:"cover"}},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"100%"},attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline",staticStyle:{"font-size":"40px"}})])]),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini",filterable:""},on:{change:t.updateTaskInfo,"visible-change":t.changeUserAvatar},model:{value:t.param.userId,callback:function(e){t.$set(t.param,"userId",e)},expression:"param.userId"}},t._l(t.userOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.nickName,value:t.userId}})})),1),e("span",{staticClass:"title"},[t._v("执行人")])],1)],1),e("div",{staticClass:"panel"},[e("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t.projectCover,fit:"cover"}},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"100%"},attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline",staticStyle:{"font-size":"40px"}})])]),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini",filterable:""},on:{change:t.updateTaskInfo,"visible-change":t.changeProjectCover},model:{value:t.param.projectId,callback:function(e){t.$set(t.param,"projectId",e)},expression:"param.projectId"}},t._l(t.projectOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.projectName,value:t.projectId}})})),1),e("span",{staticClass:"title"},[t._v("所属项目")])],1)],1),e("div",{staticClass:"panel"},[0===t.param.executeStatus?e("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"40px",color:"#e6a23c"}}):1===t.param.executeStatus?e("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"40px",color:"#409eff"}}):e("i",{staticClass:"el-icon-circle-check",staticStyle:{"font-size":"40px",color:"#67c23a"}}),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.param.executeStatus,callback:function(e){t.$set(t.param,"executeStatus",e)},expression:"param.executeStatus"}},t._l(t.executeStatusOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),1),e("span",{staticClass:"title"},[t._v("执行状态")])],1)]),e("div",{staticClass:"panel"},[0===t.param.status?e("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"40px",color:"#e6a23c"}}):1===t.param.status?e("i",{staticClass:"el-icon-time",staticStyle:{"font-size":"40px",color:"#409eff"}}):2===t.param.status?e("i",{staticClass:"el-icon-circle-check",staticStyle:{"font-size":"40px",color:"#67c23a"}}):e("i",{staticClass:"el-icon-warning-outline",staticStyle:{"font-size":"40px",color:"#f56c6c"}}),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.param.status,callback:function(e){t.$set(t.param,"status",e)},expression:"param.status"}},t._l(t.statusOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),1),e("span",{staticClass:"title"},[t._v("任务状态")])],1)]),e("div",{staticClass:"panel"},[0===t.param.taskPriority?e("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"40px",color:"#f56c6c"}}):1===t.param.taskPriority?e("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"40px",color:"#f56c6ccc"}}):2===t.param.taskPriority?e("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"40px",color:"#f56c6caa"}}):3===t.param.taskPriority?e("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"40px",color:"#f56c6c99"}}):e("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"40px",color:"#f56c6c77"}}),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.param.taskPriority,callback:function(e){t.$set(t.param,"taskPriority",e)},expression:"param.taskPriority"}},t._l(t.taskPriorityOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),1),e("span",{staticClass:"title"},[t._v("优先级")])],1)]),e("div",{staticClass:"panel"},[e("i",{staticClass:"el-icon-s-flag",staticStyle:{"font-size":"40px",color:"#409eff"}}),e("div",{staticClass:"content"},[e("el-select",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.param.projectStageId,callback:function(e){t.$set(t.param,"projectStageId",e)},expression:"param.projectStageId"}},t._l(t.stageOptions,(function(t,a){return e("el-option",{key:a,attrs:{label:t.stageName,value:t.stageId}})})),1),e("span",{staticClass:"title"},[t._v("所属阶段")])],1)]),e("div",{staticClass:"panel"},[e("i",{staticClass:"el-icon-collection-tag",staticStyle:{"font-size":"40px",color:"#409eff"}}),e("div",{staticClass:"content"},[e("el-input",{attrs:{size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.param.taskFlow,callback:function(e){t.$set(t.param,"taskFlow","string"===typeof e?e.trim():e)},expression:"param.taskFlow"}}),e("span",{staticClass:"title"},[t._v("所属流程")])],1)])]),e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"maxHeight70",attrs:{span:12}},[e("el-card",{staticClass:"description-wrapper",attrs:{shadow:"never"}},[e("div",{staticStyle:{"font-size":"16px","font-weight":"bold","margin-bottom":"20px"}},[t._v("描述")]),e("editor",{attrs:{"min-height":192},on:{input:t.updateTaskInfoStabilization},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1),e("el-card",{staticClass:"basic-wrapper",attrs:{shadow:"never"}},[e("el-descriptions",{attrs:{column:1,title:"基础信息"}},[e("el-descriptions-item",{attrs:{label:"所属项目"}},[t._v(t._s(t.basic.projectName))]),e("el-descriptions-item",{attrs:{label:"所属阶段"}},[t._v(t._s(t.basic.stageName))]),e("el-descriptions-item",{attrs:{label:"所属流程"}},[t._v(t._s(t.basic.taskFlow))]),e("el-descriptions-item",{attrs:{label:"创建者"}},[t._v(t._s(t.basic.executor))]),e("el-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.basic.createdTime))]),e("el-descriptions-item",{attrs:{label:"更新时间"}},[t._v(t._s(t.basic.updatedTime))])],1)],1),e("el-card",{staticClass:"progress-wrapper",attrs:{shadow:"never"}},[e("el-descriptions",{attrs:{column:1,title:"周期与进度"}},[e("el-descriptions-item",{attrs:{label:"预计开始日期"}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.progress.beginTime,callback:function(e){t.$set(t.progress,"beginTime",e)},expression:"progress.beginTime"}})],1),e("el-descriptions-item",{attrs:{label:"预计完成日期"}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.progress.endTime,callback:function(e){t.$set(t.progress,"endTime",e)},expression:"progress.endTime"}})],1),e("el-descriptions-item",{attrs:{label:"截止日期"}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.progress.closeTime,callback:function(e){t.$set(t.progress,"closeTime",e)},expression:"progress.closeTime"}})],1),e("el-descriptions-item",{attrs:{label:"进度 ".concat(t.progress.taskProcess,"%")}},[e("el-input-number",{attrs:{min:0,max:100,size:"mini"},on:{change:t.updateTaskInfo},model:{value:t.progress.taskProcess,callback:function(e){t.$set(t.progress,"taskProcess",e)},expression:"progress.taskProcess"}})],1)],1)],1),e("el-card",{staticClass:"subtask-wrapper",attrs:{shadow:"never"}},[e("template",{slot:"header"},[e("span",[t._v("子任务")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){t.createSubTaskDialogVisible=!0}}},[t._v("添加")])],1),t._l(t.subTaskList,(function(a,s){return e("div",{key:s,staticClass:"item",on:{click:function(e){return t.clickSubTask(a.taskId,a.taskName)}}},[e("span",[t._v(t._s(a.taskName))]),0===a.status?e("el-tag",{attrs:{type:"info"}},[t._v(t._s(a.statusName))]):1===a.status?e("el-tag",[t._v(t._s(a.statusName))]):2===a.status?e("el-tag",{attrs:{type:"success"}},[t._v(t._s(a.statusName))]):3===a.status?e("el-tag",{attrs:{type:"danger"}},[t._v(t._s(a.statusName))]):t._e()],1)}))],2),e("el-card",{staticClass:"deliverable-wrapper",attrs:{shadow:"never"}},[e("template",{slot:"header"},[e("span",[t._v("交付物")]),e("div",[e("el-button",{attrs:{type:"text"},on:{click:function(e){t.importTaskFileDialogVisible=!0}}},[t._v("上传交付物")])],1)]),e("el-table",{attrs:{data:t.taskFileList}},[e("el-table-column",{attrs:{label:"文件名",prop:"fileName",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"上传人",prop:"nickName",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"文件大小（KB）",prop:"fileSize",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"上传时间",prop:"createdTime",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleDownload(a.row)}}},[t._v("下载")]),e("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(e){return t.handleDelete(a.row)}}},[t._v("删除")])]}}])})],1)],2)],1),e("el-col",{attrs:{span:12}},[e("el-card",{staticClass:"dynamic-wrapper",attrs:{header:"动态",shadow:"never"}},[e("el-radio-group",{on:{input:t.changeDynamicRadio},model:{value:t.dynamicRadio,callback:function(e){t.dynamicRadio=e},expression:"dynamicRadio"}},[e("el-radio-button",{attrs:{label:-1}},[t._v("全部")]),e("el-radio-button",{attrs:{label:1}},[t._v("变更记录")]),e("el-radio-button",{attrs:{label:2}},[t._v("交付物")]),e("el-radio-button",{attrs:{label:3}},[t._v("评论")])],1),e("div",{staticClass:"maxHeight55"},t._l(t.taskLogList,(function(a,s){return e("div",{key:s,staticClass:"item"},[e("div",{staticClass:"left"},[e("img",{attrs:{src:a.avatar,width:"24px",height:"24px"}}),e("div",[e("div",{staticClass:"title"},[t._v(t._s(a.nickName)+" - "+t._s(a.remark))]),1===a.logType&&"description"!==a.content[0].field?e("div",{staticClass:"content"},[e("el-tag",{attrs:{type:"info",size:"mini"}},[t._v(t._s(a.content[0].oldValue))]),t._v(" 更改为 "),e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(a.content[0].newValue))])],1):t._e(),2===a.logType?e("div",{staticClass:"content"},[t._v(t._s(a.content.split("/").pop()))]):t._e(),3===a.logType?e("div",{staticClass:"content"},[t._v(t._s(a.content))]):t._e()])]),e("span",{staticClass:"right"},[t._v(t._s(a.createdTime))])])})),0),e("vue-tribute",{attrs:{options:t.tributeOptions}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tributeValue,expression:"tributeValue"}],attrs:{type:"text",placeholder:"@提及任务成员，Ctrl + Enter 发表评论"},domProps:{value:t.tributeValue},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterTribute.apply(null,arguments)},input:function(e){e.target.composing||(t.tributeValue=e.target.value)}}})])],1)],1)],1),e("CreateTaskDialog",{attrs:{visible:t.createSubTaskDialogVisible,getTableData:t.getSubTaskList,projectOptions:t.projectOptions,taskPriorityOptions:t.taskPriorityOptions,isSubTask:!0,projectId:t.projectId,taskId:this.taskId},on:{"update:visible":function(e){t.createSubTaskDialogVisible=e}}}),e("el-dialog",{attrs:{title:"上传交付物",visible:t.importTaskFileDialogVisible,width:"50%"},on:{"update:visible":function(e){t.importTaskFileDialogVisible=e}}},[e("h3",[t._v("第一步：下载交付物模板")]),e("p",[t._v("请先下载「交付物模板」并按照模板要求上传交付物。")]),e("p",[t._v("提示：若无交付物模板，请联系项目经理；若无需模板，请直接第二步导入交付物")]),e("el-button",{on:{click:t.downloadTaskTemplate}},[t._v("下载模板")]),e("h3",[t._v("第二步：上传交付物")]),e("el-upload",{attrs:{action:t.uploadFileUrl,headers:t.uploadFileHeaders,data:t.uploadFileData,"show-file-list":!1,"auto-upload":!0,"before-upload":t.handleBeforeUpload,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError}},[e("el-button",{attrs:{type:"primary"}},[t._v("导入")])],1)],1)],1)},i=[],o=(a("d3b7"),a("14d9"),a("ddb0"),a("021a")),r=a("5f87"),l=a("24cb"),n=a("f8fa"),c=a("31ed"),p=a("95c7"),d=a("996e"),u={name:"MyTaskInfo",components:{VueTribute:l["a"],CreateTaskDialog:d["default"]},props:{},data:function(){return{taskId:"",projectId:"",taskName:"",userAvatar:"",projectCover:"",param:{userId:"",projectId:"",executeStatus:"",status:"",taskPriority:"",projectStageId:"",taskFlow:""},userOptions:[],projectOptions:[],executeStatusOptions:[{label:"未开始",value:0},{label:"进行中",value:1},{label:"已完成",value:2}],statusOptions:[{label:"未开始",value:0},{label:"进行中",value:1},{label:"已完成",value:2},{label:"已逾期",value:3}],taskPriorityOptions:[{label:"最高",value:0},{label:"较高",value:1},{label:"普通",value:2},{label:"较低",value:3},{label:"最低",value:4}],stageOptions:[],description:"",timerId:void 0,basic:{projectName:"",stageName:"",taskFlow:"",executor:"",createdTime:"",updatedTime:""},progress:{beginTime:"",endTime:"",closeTime:"",taskProcess:0},subTaskList:[],createSubTaskDialogVisible:!1,taskFileList:[],importTaskFileDialogVisible:!1,uploadFileUrl:"/prod-api/project/file/upload",uploadFileHeaders:{Authorization:"Bearer "+Object(r["a"])()},uploadFileData:{id:this.$route.query.taskId,type:"task"},taskLogList:[],dynamicRadio:-1,tributeValue:"",tributeOptions:{trigger:"@",requireLeadingSpace:!1,values:[]}}},methods:{init:function(){var t=this;Object(n["f"])(this.taskId).then((function(e){t.projectId=e.data.projectId,t.taskName=e.data.taskName,t.param.userId=e.data.userId,t.param.projectId=e.data.projectId,t.param.executeStatus=e.data.executeStatus,t.param.status=e.data.status,t.param.taskPriority=e.data.taskPriority,t.param.projectStageId=e.data.projectStageId,t.param.taskFlow=e.data.taskFlow,t.description=e.data.description,t.basic.projectName=e.data.projectName,t.basic.stageName=e.data.stageName,t.basic.taskFlow=e.data.taskFlow,t.basic.executor=e.data.executor,t.basic.createdTime=e.data.createdTime,t.basic.updatedTime=e.data.updatedTime,t.progress.beginTime=e.data.beginTime,t.progress.endTime=e.data.endTime,t.progress.closeTime=e.data.closeTime,t.progress.taskProcess=e.data.taskProcess,Object(n["g"])(t.projectId).then((function(e){t.userOptions=e.data,t.changeUserAvatar()})),Object(p["o"])(t.projectId).then((function(e){t.stageOptions=e.data}))})),Object(c["c"])().then((function(e){t.projectOptions=e.data,Object(o["a"])(t.projectOptions),t.changeProjectCover()})),this.getTaskLog(),this.getTaskUserList()},changeUserAvatar:function(){for(var t=this.userOptions,e=this.param.userId,a=0;a<t.length;a++)if(t[a].userId===e)return void(this.userAvatar="/prod-api"+t[a].avatar)},changeProjectCover:function(){for(var t=this.projectOptions,e=this.param.projectId,a=0;a<t.length;a++)if(t[a].projectId===e)return void(this.projectCover="/prod-api"+t[a].cover)},updateTaskInfo:function(){var t=this,e={taskName:this.taskName,userId:this.param.userId,projectId:this.param.projectId,executeStatus:this.param.executeStatus,status:this.param.status,taskPriority:this.param.taskPriority,projectStageId:this.param.projectStageId,taskFlow:this.param.taskFlow,description:this.description,beginTime:this.progress.beginTime?this.progress.beginTime:"",endTime:this.progress.endTime?this.progress.endTime:"",closeTime:this.progress.closeTime?this.progress.closeTime:"",taskProcess:this.progress.taskProcess,taskId:this.taskId};Object(n["m"])(e).then((function(e){t.$modal.msgSuccess("修改任务成功")})).finally((function(){t.init()}))},updateTaskInfoStabilization:function(){var t=this;this.timerId&&clearTimeout(this.timerId),void 0===this.timerId?this.timerId=null:this.timerId=setTimeout((function(){t.updateTaskInfo(),t.timerId=null}),2e3)},getSubTaskList:function(){var t=this;Object(n["e"])(this.taskId).then((function(e){t.subTaskList=e.data})).catch((function(){t.subTaskList=[]}))},clickSubTask:function(t,e){this.$router.push({path:"/pmhub-project/my-task/child/info",query:{taskId:t}})},getTaskFileList:function(){var t=this;Object(p["h"])({pageNum:1,pageSize:50,fileName:void 0,id:this.taskId,type:"task"}).then((function(e){t.taskFileList=e.data.list})).catch((function(){t.taskFileList=[]}))},downloadTaskTemplate:function(){this.download("/project/task/file/downloadTemplate",{taskId:this.taskId})},handleBeforeUpload:function(t){this.$modal.loading("上传文件中...");var e=t.size/1024/1024<50;return e||(this.$message.error("上传文件大小不能超过 50MB!"),this.$modal.closeLoading()),e},handleUploadError:function(){this.$modal.closeLoading(),this.$modal.msgError("上传文件失败")},handleUploadSuccess:function(t){this.$modal.closeLoading(),200===t.code?(this.$modal.msgSuccess("上传文件成功"),this.importTaskFileDialogVisible=!1,this.getTaskFileList()):this.$modal.msgError(t.msg||"上传文件异常")},handleDownload:function(t){this.download("/project/file/download",{projectFileId:t.projectFileId,fileUrl:t.fileUrl},t.fileName)},handleDelete:function(t){var e=this,a={fileVOList:[{projectFileId:t.projectFileId,fileUrl:t.fileUrl}]};this.$modal.confirm("是否确认删除文件：".concat(t.fileName,"？")).then((function(){return Object(p["d"])(a)})).then((function(){e.$modal.msgSuccess("删除成功"),e.getTaskFileList()})).catch((function(){}))},getTaskLog:function(){var t=this;Object(n["i"])({pageNum:1,pageSize:100,logType:this.dynamicRadio,taskId:this.taskId}).then((function(e){for(var s=0;s<e.data.length;s++){var i=e.data[s].avatar;e.data[s].avatar=""==i||null==i?a("81a5"):"/prod-api"+i}t.taskLogList=e.data})).catch((function(){t.taskLogList=[]}))},getTaskUserList:function(){var t=this;Object(n["j"])(this.taskId).then((function(e){for(var a=0;a<e.data.length;a++)t.tributeOptions.values.push({key:e.data[a].nickName,value:e.data[a].nickName})})).catch((function(){t.tributeOptions.values=[]}))},changeDynamicRadio:function(t){this.getTaskLog()},enterTribute:function(t){var e=this;t.ctrlKey&&13===t.keyCode&&Object(n["a"])({projectId:this.projectId,taskId:this.taskId,comment:this.tributeValue,userIdList:[]}).then((function(t){e.$modal.msgSuccess("评论成功"),e.tributeValue="",e.getTaskLog()}))}},mounted:function(){this.taskId=this.$route.query.taskId,this.init(),this.getSubTaskList(),this.getTaskFileList()},beforeDestroy:function(){}},m=u,f=(a("9202"),a("2877")),k=Object(f["a"])(m,s,i,!1,null,"4eb75e40",null);e["default"]=k.exports}}]);